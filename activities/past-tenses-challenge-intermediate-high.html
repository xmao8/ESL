<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Past Tenses Challenge â€“ Intermediate High</title>
  <link rel="icon" href="/favicon.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body { display:flex; flex-direction:column; min-height:100vh; margin:0; font-family:'Segoe UI', Arial, sans-serif; background:#f0f4f8; color:#333; line-height:1.6; }
    main { flex:1; padding:2rem 1rem; }
    a { text-decoration:none; color:inherit; }
    h1,h2 { color:#124076; font-family:'Poppins',sans-serif; font-weight:700; }

    /* NAVBAR */
    nav{ background:#124076; width:100%; padding:.8rem 1rem; }
    .nav-container{ display:flex; justify-content:space-between; align-items:center; max-width:1100px; margin:0 auto; }
    .logo{ display:flex; align-items:center; }
    .logo-img{ width:32px; height:32px; margin-right:.5rem; }
    .site-name{ font-family:'Poppins',sans-serif; font-size:1.3rem; color:#ff9800; font-weight:700; white-space:nowrap; }
    .nav-links{ display:flex; gap:1.5rem; }
    .nav-links a{ color:#fff; font-weight:700; }
    .nav-links a:hover,.nav-links a:focus{ color:#ffbb33; text-decoration:underline; outline:none; }
    .menu-toggle{ display:none; flex-direction:column; gap:5px; background:none; border:none; cursor:pointer; }
    .menu-toggle .bar{ width:25px; height:3px; background:#fff; border-radius:2px; transition:all .3s; }

    /* CONTAINER */
    .game-container{ max-width:1150px; margin:2rem auto 3rem; background:#fff; padding:2.5rem; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,.1); }
    .game-container h1{ font-size:2.6rem; margin:0 0 1.25rem; text-align:center; letter-spacing:.5px; }

    #scores{ display:flex; justify-content:center; gap:4rem; font-size:1.4rem; margin-bottom:1.25rem; font-weight:700; color:#2c3e50; }

    .legend{ text-align:center; font-size:.95rem; color:#546a7b; margin:-.25rem 0 1rem; }

    /* BOARD: 3 categories */
    .board{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; padding:15px; background:#e0e7ed; border-radius:8px; box-shadow:inset 0 0 10px rgba(0,0,0,.08); }
    .cell{ background:#124076; border:1px solid #0d9ddb; padding:18px; font-size:1.45rem; min-height:110px; display:flex; align-items:center; justify-content:center; cursor:pointer; text-align:center; color:#fff; font-weight:800; border-radius:8px; transition:background-color .2s, transform .1s, box-shadow .2s; box-shadow:0 4px 8px rgba(0,0,0,.1); }
    .cell:hover:not(.disabled):not(.category){ background:#0d9ddb; transform:translateY(-3px); box-shadow:0 6px 12px rgba(0,0,0,.2); }
    .cell.disabled{ background:#95a5a6; color:#e0e7ed; pointer-events:none; box-shadow:inset 0 0 8px rgba(0,0,0,.2); }
    .category{ background:#2c3e50; color:#fff; font-size:1.05rem; text-transform:uppercase; letter-spacing:.5px; }

    /* MODAL */
    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.8); display:none; align-items:center; justify-content:center; z-index:1000; }
    .modal.show{ display:flex; }
    .modal-content{ background:#fff; color:#333; padding:2rem; max-width:760px; width:min(92%,760px); border-radius:12px; text-align:center; box-shadow:0 10px 25px rgba(0,0,0,.5); border:1px solid #ddd; animation:fadeIn .25s ease-out; }
    @keyframes fadeIn{ from{opacity:0; transform:scale(.95)} to{opacity:1; transform:scale(1)} }
    #question{ font-size:1.7rem; margin:0 0 1rem; color:#124076; font-family:'Poppins',sans-serif; }

    .answer-input{ width:100%; max-width:560px; margin-inline:auto; font-size:1.1rem; padding:.75rem 1rem; border-radius:10px; border:1px solid #c9d6e8; outline:none; }
    #smallHint{ margin-top:.5rem; font-size:.95rem; color:#6b7c8d; }

    .options{ display:grid; grid-template-columns:1fr; gap:.6rem; margin:1rem auto; max-width:580px; text-align:left; }
    .option{ background:#f6f9fc; border:1px solid #dbe6f6; padding:.65rem .8rem; border-radius:10px; cursor:pointer; }
    .option input{ margin-right:.5rem; }

    #answerBlock{ margin-top:.85rem; display:none; }
    #explanation{ font-size:.95rem; color:#555; margin-top:.25rem; }
    #feedback{ font-weight:700; margin-top:.25rem; }

    .controls{ display:flex; flex-wrap:wrap; gap:.6rem; justify-content:center; margin-top:1rem; }
    .btn{ margin:.25rem; padding:12px 22px; font-size:1rem; cursor:pointer; border:none; border-radius:10px; transition:background-color .2s, transform .1s, box-shadow .2s; box-shadow:0 3px 6px rgba(0,0,0,.2); font-weight:800; }
    .btn:hover{ transform:translateY(-2px); box-shadow:0 5px 10px rgba(0,0,0,.3); }
    .btn-primary{ background:#ff9800; color:#fff; }
    .btn-primary:hover{ background:#e68900; }
    .btn-success{ background:#28a745; color:#fff; }
    .btn-success:hover{ background:#218838; }
    .btn-blue{ background:#007bff; color:#fff; }
    .btn-blue:hover{ background:#0056b3; }
    .btn-gray{ background:#6c757d; color:#fff; }
    .btn-gray:hover{ background:#5a6268; }
    .btn-outline{ background:#fff; color:#124076; border:2px solid #124076; }

    @media (max-width: 600px){
      .nav-links{ position:fixed; top:56px; right:0; background:#124076; flex-direction:column; width:100%; height:calc(100vh - 56px); padding:1.5rem; gap:1rem; overflow-y:auto; transform:translateX(100%); transition:transform .3s ease-out; z-index:998; align-items:flex-start; border-radius:0 0 0 10px; }
      .nav-links.active{ transform:translateX(0); }
      .menu-toggle{ display:flex; }
      .site-name{ font-size:1.2rem; }
      .board{ gap:6px; padding:10px; grid-template-columns:repeat(2,1fr); }
      .cell{ min-height:86px; font-size:1.15rem; }
      .game-container{ padding:1rem; }
      .game-container h1{ font-size:2rem; }
      #scores{ font-size:1.2rem; gap:2rem; }
    }
  </style>
</head>
<body>
  <nav role="navigation" aria-label="Main navigation">
    <div class="nav-container">
      <a href="../index.html" class="logo" aria-label="ESLnote Home">
        <img src="/favicon.png" alt="ESLnote Logo" class="logo-img" />
        <span class="site-name">ESLnote</span>
      </a>
      <button class="menu-toggle" aria-controls="primary-navigation" aria-expanded="false" aria-label="Toggle menu" id="menuToggle">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
      </button>
      <div class="nav-links" id="primary-navigation">
        <a href="../index.html">Home</a>
        <a href="../flashcards.html">Flashcards</a>
        <a href="../conversation.html">Conversations</a>
        <a href="../grammar.html">Grammar</a>
        <a href="../reading.html">Reading</a>
        <a href="../practice.html">Practice</a>
      </div>
    </div>
  </nav>

  <main class="game-container">
    <h1>Past Tenses Challenge (Intermediateâ€‘High)</h1>
    <p class="legend">Focuses on nuanced use of <strong>Simple Past</strong>, <strong>Past Progressive</strong>, and <strong>Past Perfect</strong>. Includes irregular verbs, negatives & questions with <em>did</em>, time expressions (<em>ago, last, in + year</em>), background vs. interruption (<em>when/while</em>), and sequencing with <em>before/after/by the time/already</em>.</p>

    <div id="scores">
      <div>Team A: <span id="scoreA">0</span></div>
      <div>Team B: <span id="scoreB">0</span></div>
    </div>

    <div class="board" id="board"></div>

    <div class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="question">
      <div class="modal-content">
        <h2 id="question">Question</h2>

        <div id="fillWrapper" style="display:none;">
          <input id="userAnswer" class="answer-input" type="text" placeholder="Type your answer here" autocomplete="off"/>
          <div id="smallHint"></div>
        </div>

        <div id="mcWrapper" style="display:none;">
          <div id="options" class="options"></div>
        </div>

        <div id="answerBlock">
          <p><strong>Answer:</strong> <span id="answer">...</span></p>
          <div id="explanation"></div>
        </div>

        <div id="feedback" aria-live="polite"></div>

        <div class="controls">
          <button id="checkBtn" class="btn btn-primary">Check</button>
          <button id="showAnswerButton" class="btn btn-outline">Show Answer</button>
          <button class="btn btn-success" onclick="claimPoints('A')">Team A Correct</button>
          <button class="btn btn-blue" onclick="claimPoints('B')">Team B Correct</button>
          <button class="btn btn-gray" onclick="closeModal(true)">Close</button>
        </div>
      </div>
    </div>
  </main>

  <audio id="clickSound" src="click.mp3"></audio>
  <audio id="correctSound" src="correct.mp3"></audio>

  <script>
    const categories = ['Simple Past','Past Progressive','Past Perfect'];

    // Each item: { type:'fill'|'mc', q:'', a:['answers'], exp:'', options?:[], hint?:'' }
    const questions = {
      'Simple Past': [
        { type:'fill', q:"We ___ (have) a great time at the festival last weekend.", a:['had'], exp:'Finished action at a finished time in the past â†’ Simple Past (irregular verb: have â†’ had).', hint:'irregular: have â†’ had' },
        { type:'mc', q:"Which negative sentence is correct in the simple past?", options:[
          "She didn't went to class.",
          "She didn't go to class.",
          "She doesn't went to class.",
          "She not went to class."
        ], a:["She didn't go to class."], exp:'Use <em>did + not</em> + base verb (no past on the main verb).'},
        { type:'fill', q:"When ___ you ___ (find) out about the schedule change?", a:['did ... find','did you find'], exp:'WHâ€‘question with <em>did</em> + subject + base verb.'},
        { type:'mc', q:"Choose the correct simple past form:", options:[
          'They make a mistake.',
          'They maked a mistake.',
          'They made a mistake.',
          'They have made a mistake.'
        ], a:['They made a mistake.'], exp:'Irregular past: make â†’ made.'},
        { type:'fill', q:"I ___ (be) born in 1995.", a:['was'], exp:'<em>be</em> in the past â†’ was/were. Fixed expression: was born.'}
      ],
      'Past Progressive': [
        { type:'mc', q:"Which sentence shows an action in progress interrupted by another past action?", options:[
          'I walked home when it started to rain.',
          'I was walking home when it started to rain.',
          'I have walked home when it started to rain.',
          'I am walking home when it started to rain.'
        ], a:['I was walking home when it started to rain.'], exp:'Background action (was walking) + shorter interrupting event (started).'},
        { type:'fill', q:"At 8 p.m. last night, we ___ (eat) dinner.", a:['were eating'], exp:'Action in progress at a specific past time â†’ Past Progressive.'},
        { type:'mc', q:"Choose the best option: She ___ on the phone while she ___.", options:[
          'talked; cooked',
          'was talking; was cooking',
          'was talking; cooked',
          'talked; was cooking'
        ], a:['was talking; was cooking'], exp:'Parallel background actions with <em>while</em> â†’ both in Past Progressive.'},
        { type:'fill', q:"What ___ you ___ (do) when the lights went out?", a:['were ... doing','were you doing'], exp:'Question form: <em>was/were</em> + subject + <em>Vâ€‘ing</em>.'},
        { type:'mc', q:"Which sentence with a stative verb is more natural?", options:[
          'I was knowing the answer.',
          'I knew the answer.',
          'I was owning a car.',
          'I was believing you.'
        ], a:['I knew the answer.'], exp:'Stative verbs (know, believe, own) rarely take progressive forms for states.'}
      ],
      'Past Perfect': [
        { type:'fill', q:"By the time the train arrived, we ___ (buy) our tickets.", a:['had bought'], exp:'Earlier past action before another past event â†’ <em>had + past participle</em>.'},
        { type:'mc', q:"Which sentence correctly shows the earlier action with the past perfect?", options:[
          'I had finished the exam before the bell rang.',
          'I finished the exam before the bell had rung.',
          'I finished the exam before the bell was ringing.',
          'I have finished the exam before the bell rang.'
        ], a:['I had finished the exam before the bell rang.'], exp:'Use past perfect for the earlier action; the later action stays in simple past.'},
        { type:'fill', q:"She ___ never ___ (see) snow before she moved to Canada.", a:['had never seen'], exp:'Negative experience up to a point in the past â†’ past perfect.'},
        { type:'mc', q:"Complete the idea: When we got to the theater, the movie ___.", options:[
          'has started',
          'started',
          'had started',
          'was starting'
        ], a:['had started'], exp:'The movie started earlier than our arrival â†’ past perfect.'},
        { type:'fill', q:"How long ___ they ___ (live) in Berlin before they relocated?", a:['had ... lived','had they lived'], exp:'Duration up to a point in the past â†’ past perfect.'}
      ]
    };

    // Build board: 3 columns Ã— (1 header + 5 rows)
    const board = document.getElementById('board');
    board.innerHTML = '';

    categories.forEach(cat=>{
      const cell = document.createElement('div');
      cell.className = 'cell category';
      cell.textContent = cat;
      board.appendChild(cell);
    });

    for(let row=0; row<5; row++){
      categories.forEach(cat=>{
        const qObj = questions[cat][row];
        const value = (row+1)*100;
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.textContent = value + (qObj.type==='fill' ? ' âœï¸' : ' ðŸ…°ï¸');
        cell.dataset.category = cat;
        cell.dataset.index = String(row);
        cell.title = qObj.type==='fill' ? 'Fill in the blank' : 'Multiple choice';
        cell.addEventListener('click', ()=> openQuestion(cat, row, cell, value));
        board.appendChild(cell);
      });
    }

    // Scores & modal state
    let scoreA=0, scoreB=0; let currentCell=null, currentQ=null, currentValue=0;
    const scoreAEl = document.getElementById('scoreA');
    const scoreBEl = document.getElementById('scoreB');
    const modal = document.getElementById('modal');
    const questionEl = document.getElementById('question');
    const fillWrapper = document.getElementById('fillWrapper');
    const mcWrapper = document.getElementById('mcWrapper');
    const smallHint = document.getElementById('smallHint');
    const userAnswer = document.getElementById('userAnswer');
    const optionsDiv = document.getElementById('options');
    const answerBlock = document.getElementById('answerBlock');
    const answerEl = document.getElementById('answer');
    const explanationEl = document.getElementById('explanation');
    const feedback = document.getElementById('feedback');
    const checkBtn = document.getElementById('checkBtn');
    const showAnswerBtn = document.getElementById('showAnswerButton');
    const clickSound = document.getElementById('clickSound');
    const correctSound = document.getElementById('correctSound');

    function openQuestion(cat, idx, cell, value){
      const q = questions[cat][idx];
      currentCell = cell; currentQ = q; currentValue = value;
      feedback.textContent = '';
      answerBlock.style.display = 'none';
      answerEl.textContent = '';
      explanationEl.textContent = '';

      questionEl.innerHTML = q.q; // allow <em> tags

      if(q.type==='fill'){
        fillWrapper.style.display = 'block';
        mcWrapper.style.display = 'none';
        userAnswer.value = '';
        smallHint.textContent = q.hint || '';
        setTimeout(()=>userAnswer.focus(), 40);
      } else {
        fillWrapper.style.display = 'none';
        mcWrapper.style.display = 'block';
        optionsDiv.innerHTML = '';
        q.options.forEach((opt,i)=>{
          const id = 'opt'+i;
          const label = document.createElement('label');
          label.className = 'option';
          label.setAttribute('for', id);
          label.innerHTML = `<input type="radio" name="mc" id="${id}" value="${opt}"> ${opt}`;
          optionsDiv.appendChild(label);
        });
      }

      showAnswerBtn.style.display = 'inline-block';
      checkBtn.style.display = 'inline-block';

      modal.classList.add('show');
      try{ clickSound.currentTime=0; clickSound.play(); }catch(e){}
    }

    function normalize(str){
      return (str||'')
        .toLowerCase()
        .replace(/\s+/g,' ')
        .replace(/â€¦/g,'...')
        .trim();
    }

    function isCorrect(user, accepted){
      const u = normalize(user)
        .replace(/\s*â€”\s*/g,' ')
        .replace(/\s*\.\.\.$/,'');
      return accepted.some(acc=>{
        const a = normalize(acc);
        // allow punctuation variations and ellipses
        return u === a || u.replace(/[\.!?]/g,'') === a.replace(/[\.!?]/g,'');
      });
    }

    function checkAnswer(){
      if(!currentQ) return;
      if(currentQ.type==='fill'){
        const u = userAnswer.value;
        if(!u.trim()){ feedback.textContent = 'Type an answer first.'; return; }
        const ok = isCorrect(u, currentQ.a);
        feedback.textContent = ok ? 'âœ… Correct!' : 'âŒ Not quite.';
        if(ok) try{ correctSound.currentTime=0; correctSound.play(); }catch(e){}
        showSolution();
      } else {
        const chosen = document.querySelector('input[name="mc"]:checked');
        if(!chosen){ feedback.textContent = 'Choose an option.'; return; }
        const ok = isCorrect(chosen.value, currentQ.a);
        feedback.textContent = ok ? 'âœ… Correct!' : 'âŒ Not quite.';
        if(ok) try{ correctSound.currentTime=0; correctSound.play(); }catch(e){}
        showSolution();
      }
    }

    function showSolution(){
      if(!currentQ) return;
      answerBlock.style.display = 'block';
      answerEl.textContent = Array.isArray(currentQ.a) ? currentQ.a.join('  /  ') : currentQ.a;
      explanationEl.innerHTML = currentQ.exp || '';
    }

    function claimPoints(team){
      if(!currentCell || currentCell.classList.contains('disabled')) return;
      const points = currentValue;
      if(team==='A'){ scoreA += points; scoreAEl.textContent = scoreA; }
      else { scoreB += points; scoreBEl.textContent = scoreB; }
      try{ correctSound.currentTime=0; correctSound.play(); }catch(e){}
      currentCell.classList.add('disabled');
      currentCell.textContent = '';
      closeModal(false);
    }

    function closeModal(disableCell){
      modal.classList.remove('show');
      if(currentCell && disableCell){ currentCell.classList.add('disabled'); currentCell.textContent=''; }
      currentCell=null; currentQ=null; currentValue=0;
      const checked = document.querySelector('input[name="mc"]:checked');
      if(checked) checked.checked=false;
    }

    document.getElementById('checkBtn').addEventListener('click', checkAnswer);
    document.getElementById('showAnswerButton').addEventListener('click', showSolution);

    // Nav mobile toggle
    const menuToggle = document.getElementById('menuToggle');
    const navLinks = document.getElementById('primary-navigation');
    if(menuToggle && navLinks){
      menuToggle.addEventListener('click', ()=>{
        const expanded = menuToggle.getAttribute('aria-expanded')==='true' || false;
        menuToggle.setAttribute('aria-expanded', !expanded);
        navLinks.classList.toggle('active');
      });
      navLinks.querySelectorAll('a').forEach(link=>link.addEventListener('click', ()=>{
        if(navLinks.classList.contains('active')){ navLinks.classList.remove('active'); menuToggle.setAttribute('aria-expanded', false); }
      }));
    }
  </script>
</body>
</html>
