<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Present Tenses Challenge – ESLnote Style</title>
  <link rel="icon" href="/favicon.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet">
  <style>
    /* Universal Box-Sizing */
    * { box-sizing: border-box; }

    /* PAGE SETUP */
    body {
      display: flex; flex-direction: column; min-height: 100vh; margin: 0;
      font-family: 'Segoe UI', Arial, sans-serif; background: #f0f4f8; color: #333; line-height: 1.6;
    }
    main { flex: 1; padding: 2rem 1rem; }
    a { text-decoration: none; color: inherit; }
    h1, h2 { color: #124076; font-family: 'Poppins', sans-serif; font-weight: 700; }

    /* NAVBAR */
    nav { background: #124076; width: 100%; padding: 0.8rem 1rem; }
    .nav-container { display: flex; justify-content: space-between; align-items: center; max-width: 1100px; margin: 0 auto; }
    .logo { display: flex; align-items: center; }
    .logo-img { width: 32px; height: 32px; margin-right: .5rem; }
    .site-name { font-family: 'Poppins', sans-serif; font-size: 1.3rem; color: #ff9800; font-weight: 700; white-space: nowrap; }
    .nav-links { display: flex; gap: 1.5rem; }
    .nav-links a { color: #fff; font-weight: 700; }
    .nav-links a:hover, .nav-links a:focus { color: #ffbb33; text-decoration: underline; outline: none; }
    .menu-toggle { display: none; flex-direction: column; gap: 5px; background: none; border: none; cursor: pointer; }
    .menu-toggle .bar { width: 25px; height: 3px; background: white; border-radius: 2px; transition: all .3s; }

    /* CONTAINER */
    .game-container { max-width: 1050px; margin: 2rem auto 3rem; background: #fff; padding: 2.5rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,.1); }
    .game-container h1 { font-size: 2.6rem; margin: 0 0 1.25rem; text-align: center; letter-spacing: .5px; }

    #scores { display: flex; justify-content: center; gap: 4rem; font-size: 1.4rem; margin-bottom: 1.25rem; font-weight: 700; color: #2c3e50; }

    /* MODE SWITCHER */
    .mode-row { display: flex; justify-content: center; gap: .75rem; margin-bottom: 1rem; flex-wrap: wrap; }
    .mode-row .badge { background: #e8eef5; color: #124076; border: 1px solid #cdd9ea; padding: .4rem .7rem; border-radius: 999px; font-weight: 700; }

    /* BOARD */
    .board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px; background: #e0e7ed; border-radius: 8px; box-shadow: inset 0 0 10px rgba(0,0,0,.08); }
    .cell { background: #124076; border: 1px solid #0d9ddb; padding: 18px; font-size: 1.5rem; min-height: 110px; display: flex; align-items: center; justify-content: center; cursor: pointer; text-align: center; color: #fff; font-weight: 800; border-radius: 8px; transition: background-color .2s, transform .1s, box-shadow .2s; box-shadow: 0 4px 8px rgba(0,0,0,.1); }
    .cell:hover:not(.disabled):not(.category) { background: #0d9ddb; transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,.2); }
    .cell.disabled { background: #95a5a6; color: #e0e7ed; pointer-events: none; box-shadow: inset 0 0 8px rgba(0,0,0,.2); }
    .category { background: #2c3e50; color: #fff; font-size: 1.1rem; text-transform: uppercase; letter-spacing: .5px; }

    /* MODAL */
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,.8); display: none; align-items: center; justify-content: center; z-index: 1000; }
    .modal.show { display: flex; }
    .modal-content { background: #fff; color: #333; padding: 2rem; max-width: 720px; width: min(92%, 720px); border-radius: 12px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,.5); border: 1px solid #ddd; animation: fadeIn .25s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: scale(.95) } to { opacity: 1; transform: scale(1) } }
    #question { font-size: 1.7rem; margin: 0 0 1rem; color: #124076; font-family: 'Poppins', sans-serif; }
    #answerBlock { margin-top: .75rem; }
    .answer-input { width: 100%; max-width: 520px; margin-inline: auto; font-size: 1.1rem; padding: .75rem 1rem; border-radius: 10px; border: 1px solid #c9d6e8; outline: none; }
    .options { display: grid; grid-template-columns: 1fr; gap: .6rem; margin: 1rem auto; max-width: 540px; text-align: left; }
    .option { background: #f6f9fc; border: 1px solid #dbe6f6; padding: .65rem .8rem; border-radius: 10px; cursor: pointer; }
    .option input { margin-right: .5rem; }
    .feedback { font-weight: 700; margin-top: .25rem; }

    .controls { display: flex; flex-wrap: wrap; gap: .6rem; justify-content: center; margin-top: 1rem; }
    .btn { margin: .25rem; padding: 12px 22px; font-size: 1rem; cursor: pointer; border: none; border-radius: 10px; transition: background-color .2s, transform .1s, box-shadow .2s; box-shadow: 0 3px 6px rgba(0,0,0,.2); font-weight: 800; }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 10px rgba(0,0,0,.3); }
    .btn-primary { background: #ff9800; color: #fff; }
    .btn-primary:hover { background: #e68900; }
    .btn-success { background: #28a745; color: #fff; }
    .btn-success:hover { background: #218838; }
    .btn-blue { background: #007bff; color: #fff; }
    .btn-blue:hover { background: #0056b3; }
    .btn-gray { background: #6c757d; color: #fff; }
    .btn-gray:hover { background: #5a6268; }
    .btn-outline { background: #fff; color: #124076; border: 2px solid #124076; }

    .legend { text-align: center; font-size: .95rem; color: #546a7b; margin-bottom: .5rem; }

    /* MEDIA */
    @media (max-width: 600px) {
      .nav-links { position: fixed; top: 56px; right: 0; background: #124076; flex-direction: column; width: 100%; height: calc(100vh - 56px); padding: 1.5rem; gap: 1rem; overflow-y: auto; transform: translateX(100%); transition: transform .3s ease-out; z-index: 998; align-items: flex-start; border-radius: 0 0 0 10px; }
      .nav-links.active { transform: translateX(0); }
      .menu-toggle { display: flex; }
      .site-name { font-size: 1.2rem; }
      .board { gap: 6px; padding: 10px; }
      .cell { min-height: 86px; font-size: 1.25rem; }
      .game-container { padding: 1rem; }
      .game-container h1 { font-size: 2rem; }
      #scores { font-size: 1.2rem; gap: 2rem; }
    }
  </style>
</head>
<body>
  <nav role="navigation" aria-label="Main navigation">
    <div class="nav-container">
      <a href="../index.html" class="logo" aria-label="ESLnote Home">
        <img src="/favicon.png" alt="ESLnote Logo" class="logo-img" />
        <span class="site-name">ESLnote</span>
      </a>

      <button class="menu-toggle" aria-controls="primary-navigation" aria-expanded="false" aria-label="Toggle menu" id="menuToggle">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
      </button>

      <div class="nav-links" id="primary-navigation">
        <a href="../index.html">Home</a>
        <a href="../flashcards.html">Flashcards</a>
        <a href="../conversation.html">Conversations</a>
        <a href="../grammar.html">Grammar</a>
        <a href="../reading.html">Reading</a>
        <a href="../practice.html">Practice</a>
      </div>
    </div>
  </nav>

  <main class="game-container">
    <h1>Present Tenses Challenge (Beginner–Low Intermediate)</h1>

    <p class="legend">This board mixes <strong>Fill-in-the-Blank</strong> and <strong>Multiple Choice</strong> questions across the three present tenses.</p>

    <div id="scores">
      <div>Team A: <span id="scoreA">0</span></div>
      <div>Team B: <span id="scoreB">0</span></div>
    </div>

    <div class="mode-row" aria-label="Game info">
      <span class="badge">Present Simple</span>
      <span class="badge">Present Continuous</span>
      <span class="badge">Present Perfect</span>
    </div>

    <div class="board" id="board"></div>

    <div class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="question">
      <div class="modal-content">
        <h2 id="question">Question</h2>

        <div id="fillWrapper" style="display:none;">
          <input id="userAnswer" class="answer-input" type="text" placeholder="Type your answer here" autocomplete="off"/>
          <div id="smallHint" style="margin-top:.5rem; font-size:.95rem; color:#6b7c8d;"></div>
        </div>

        <div id="mcWrapper" style="display:none;">
          <div id="options" class="options"></div>
        </div>

        <div id="answerBlock" style="display:none;">
          <p><strong>Answer:</strong> <span id="answer">...</span></p>
          <div id="explanation" style="font-size: .95rem; color:#555;"></div>
        </div>

        <div class="feedback" id="feedback" aria-live="polite"></div>

        <div class="controls">
          <button id="checkBtn" class="btn btn-primary">Check</button>
          <button id="showAnswerButton" class="btn btn-outline">Show Answer</button>
          <button class="btn btn-success" onclick="claimPoints('A')">Team A Correct</button>
          <button class="btn btn-blue" onclick="claimPoints('B')">Team B Correct</button>
          <button class="btn btn-gray" onclick="closeModal(true)">Close</button>
        </div>
      </div>
    </div>
  </main>

  <audio id="clickSound" src="click.mp3"></audio>
  <audio id="correctSound" src="correct.mp3"></audio>

  <script>
    // Categories
    const categories = [
      'Present Simple',
      'Present Continuous',
      'Present Perfect'
    ];

    // Question bank
    // Each item: { type: 'fill'|'mc', q: '...', a: ['accepted','answers'], exp: 'explanation', options?: ['A','B','C','D'], hint?: '...' }
    const questions = {
      'Present Simple': [
        { type: 'fill', q: "I ___ (like) apples.", a: ['like'], exp: 'In Present Simple, use the base form with I/you/we/they: "like".', hint: 'Base form with I/you/we/they' },
        { type: 'mc', q: "She ___ to music every day.", options: ['listen', 'listens', 'listening', 'is listening'], a: ['listens'], exp: 'Third person singular takes -s: she listens.' },
        { type: 'fill', q: "They ___ (not/watch) TV on weekdays.", a: ["do not watch","don't watch"], exp: 'Use do not / don\'t + base verb.' },
        { type: 'mc', q: "What time ___ the store open?", options: ['do', 'does', 'is', 'did'], a: ['does'], exp: 'Questions with he/she/it/nouns use "does" + base verb.' },
        { type: 'fill', q: "My brother ___ (study) English.", a: ['studies'], exp: 'He/She/It adds -s or -es: study → studies.' }
      ],
      'Present Continuous': [
        { type: 'mc', q: "I ___ to the teacher right now.", options: ['talk', 'am talking', 'talks', 'have talked'], a: ['am talking'], exp: 'Present Continuous: am/is/are + -ing.' },
        { type: 'fill', q: "She ___ (not/work) today.", a: ["is not working","isn't working"], exp: 'Negative: be + not + verb-ing.' },
        { type: 'mc', q: "___ they coming to class?", options: ['Are', 'Do', 'Did', 'Have'], a: ['Are'], exp: 'Yes/No questions start with are/is/am.' },
        { type: 'fill', q: "We ___ (have) lunch now.", a: ['are having'], exp: 'be + verb-ing → are having.' },
        { type: 'mc', q: "The children ___ football at the moment.", options: ['play', 'are playing', 'plays', 'have played'], a: ['are playing'], exp: 'Signal phrase "at the moment" → Present Continuous.' }
      ],
      'Present Perfect': [
        { type: 'fill', q: "I ___ (visit) London three times.", a: ['have visited'], exp: 'have/has + past participle.' },
        { type: 'mc', q: "She ___ her homework already.", options: ['has finished', 'is finishing', 'finished', 'finishes'], a: ['has finished'], exp: 'With already/recent results → Present Perfect.' },
        { type: 'fill', q: "They ___ (not/see) that movie.", a: ["have not seen","haven't seen"], exp: 'Negative: have/has + not + past participle.' },
        { type: 'mc', q: "How long ___ you lived here?", options: ['are', 'do', 'have', 'has'], a: ['have'], exp: 'Duration from past to now → have/has + past participle.' },
        { type: 'fill', q: "He ___ never ___ (be) to Japan.", a: ['has never been'], exp: 'Adverb between has and past participle: has never been.' }
      ]
    };

    // Build board: 3 columns × 6 rows (header + 5 questions each)
    const board = document.getElementById('board');
    board.innerHTML = '';

    // Add category headers
    categories.forEach(cat => {
      const cell = document.createElement('div');
      cell.className = 'cell category';
      cell.textContent = cat;
      board.appendChild(cell);
    });

    // Add questions (5 rows)
    for (let row = 0; row < 5; row++) {
      categories.forEach(cat => {
        const qObj = questions[cat][row];
        const value = (row + 1) * 100; // points
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.textContent = value + (qObj.type === 'fill' ? ' ✍️' : ' 🅰️');
        cell.dataset.category = cat;
        cell.dataset.index = String(row);
        cell.title = qObj.type === 'fill' ? 'Fill in the blank' : 'Multiple choice';
        cell.addEventListener('click', () => openQuestion(cat, row, cell, value));
        board.appendChild(cell);
      });
    }

    // Score & modal elements
    let scoreA = 0, scoreB = 0;
    let currentCell = null; let currentQ = null; let currentValue = 0;

    const scoreAEl = document.getElementById('scoreA');
    const scoreBEl = document.getElementById('scoreB');
    const modal = document.getElementById('modal');
    const questionEl = document.getElementById('question');
    const fillWrapper = document.getElementById('fillWrapper');
    const mcWrapper = document.getElementById('mcWrapper');
    const smallHint = document.getElementById('smallHint');
    const userAnswer = document.getElementById('userAnswer');
    const optionsDiv = document.getElementById('options');
    const answerBlock = document.getElementById('answerBlock');
    const answerEl = document.getElementById('answer');
    const explanationEl = document.getElementById('explanation');
    const feedback = document.getElementById('feedback');
    const checkBtn = document.getElementById('checkBtn');
    const showAnswerBtn = document.getElementById('showAnswerButton');
    const clickSound = document.getElementById('clickSound');
    const correctSound = document.getElementById('correctSound');

    function openQuestion(cat, idx, cell, value) {
      const q = questions[cat][idx];
      currentCell = cell; currentQ = q; currentValue = value;
      feedback.textContent = '';
      answerBlock.style.display = 'none';
      answerEl.textContent = '';
      explanationEl.textContent = '';

      questionEl.textContent = q.q;

      // Setup UI by type
      if (q.type === 'fill') {
        fillWrapper.style.display = 'block';
        mcWrapper.style.display = 'none';
        userAnswer.value = '';
        smallHint.textContent = q.hint ? q.hint : '';
        setTimeout(() => userAnswer.focus(), 50);
      } else {
        fillWrapper.style.display = 'none';
        mcWrapper.style.display = 'block';
        optionsDiv.innerHTML = '';
        q.options.forEach((opt, i) => {
          const id = 'opt' + i;
          const label = document.createElement('label');
          label.className = 'option';
          label.setAttribute('for', id);
          label.innerHTML = `<input type="radio" name="mc" id="${id}" value="${opt}"> ${opt}`;
          optionsDiv.appendChild(label);
        });
      }

      showAnswerBtn.style.display = 'inline-block';
      checkBtn.style.display = 'inline-block';

      modal.classList.add('show');
      try { clickSound.currentTime = 0; clickSound.play(); } catch(e){}
    }

    function normalize(str){
      return (str||'')
        .toLowerCase()
        .replace(/\s+/g,' ')
        .replace(/[“”]/g,'\"')
        .trim();
    }

    function isCorrect(user, accepted) {
      const u = normalize(user);
      return accepted.some(acc => {
        // accept small spacing/punctuation variations
        const a = normalize(acc).replace(/\s*\?$/,'');
        return u === a || u.replace(/[\.!]/g,'') === a;
      });
    }

    function checkAnswer(){
      if (!currentQ) return;
      if (currentQ.type === 'fill') {
        const u = userAnswer.value;
        if (!u.trim()) { feedback.textContent = 'Type an answer first.'; return; }
        const ok = isCorrect(u, currentQ.a);
        feedback.textContent = ok ? '✅ Correct!' : '❌ Not quite.';
        if (ok) try { correctSound.currentTime = 0; correctSound.play(); } catch(e){}
        showSolution();
      } else {
        const chosen = document.querySelector('input[name="mc"]:checked');
        if (!chosen) { feedback.textContent = 'Choose an option.'; return; }
        const ok = isCorrect(chosen.value, currentQ.a);
        feedback.textContent = ok ? '✅ Correct!' : '❌ Not quite.';
        if (ok) try { correctSound.currentTime = 0; correctSound.play(); } catch(e){}
        showSolution();
      }
    }

    function showSolution(){
      if (!currentQ) return;
      answerBlock.style.display = 'block';
      answerEl.textContent = Array.isArray(currentQ.a) ? currentQ.a.join('  /  ') : currentQ.a;
      explanationEl.textContent = currentQ.exp || '';
    }

    function claimPoints(team){
      if (!currentCell || currentCell.classList.contains('disabled')) return;
      const points = currentValue;
      if (team === 'A') { scoreA += points; scoreAEl.textContent = scoreA; }
      else { scoreB += points; scoreBEl.textContent = scoreB; }
      try { correctSound.currentTime = 0; correctSound.play(); } catch(e){}
      currentCell.classList.add('disabled');
      currentCell.textContent = '';
      closeModal(false);
    }

    function closeModal(disableCell){
      modal.classList.remove('show');
      if (currentCell && disableCell) {
        currentCell.classList.add('disabled');
        currentCell.textContent = '';
      }
      currentCell = null; currentQ = null; currentValue = 0;
      // Clear MC selection
      const checked = document.querySelector('input[name="mc"]:checked');
      if (checked) checked.checked = false;
    }

    // Button events
    checkBtn.addEventListener('click', checkAnswer);
    showAnswerBtn.addEventListener('click', showSolution);

    // Nav mobile toggle
    const menuToggle = document.getElementById('menuToggle');
    const navLinks = document.getElementById('primary-navigation');
    if (menuToggle && navLinks) {
      menuToggle.addEventListener('click', () => {
        const expanded = menuToggle.getAttribute('aria-expanded') === 'true' || false;
        menuToggle.setAttribute('aria-expanded', !expanded);
        navLinks.classList.toggle('active');
      });
      navLinks.querySelectorAll('a').forEach(link => link.addEventListener('click', () => {
        if (navLinks.classList.contains('active')) { navLinks.classList.remove('active'); menuToggle.setAttribute('aria-expanded', false); }
      }));
    }
  </script>
</body>
</html>
